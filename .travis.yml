language: rust
branches:
  only:
    master

matrix:
  include:
    - rust: nightly
      script: cargo test --all
    - rust: stable
      script: cargo test --all
    - rust: beta
      script: cargo test --all
    - env: 
        CLIPPY: enabled
      rust: nightly
      script: cargo build --features "dev"
    - env:
        RUSTFMT: enabled
      rust: nightly
      before_script:
        - (cargo install rustfmt-nightly || true)
        - export PATH=$PATH:$HOME/.cargo/bin
      script: cargo fmt -- --write-mode=diff
  allow_failures:
    - rust: stable
    - rust: beta
